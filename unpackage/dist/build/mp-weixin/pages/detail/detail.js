"use strict";const e=require("../../common/vendor.js"),a=require("../../api/apis.js"),t=require("../../utils/system.js");if(!Array){(e.resolveComponent("uni-icons")+e.resolveComponent("uni-dateformat")+e.resolveComponent("uni-rate")+e.resolveComponent("uni-popup"))()}Math||((()=>"../../uni_modules/uni-icons/components/uni-icons/uni-icons.js")+(()=>"../../uni_modules/uni-dateformat/components/uni-dateformat/uni-dateformat.js")+(()=>"../../uni_modules/uni-rate/components/uni-rate/uni-rate.js")+(()=>"../../uni_modules/uni-popup/components/uni-popup/uni-popup.js"))();const o={__name:"detail",setup(o){let n=t.getTopStatusBarInfo().statusBarHeight,l=n+40,u=e.ref(!1),i=e.ref(null),s=e.ref(null);e.ref(3.5);let r=e.ref(0);const c=e.ref([]);let d=e.ref(0),p=e.ref([]);const f=e.ref({classid:"",nickname:"",score:0,tabs:["未知"],_id:"",description:"没有相关的描述~~~",fullPicurl:""});let v=e.ref(!1),m=e.computed((()=>c.value.length));v=e.computed((()=>{var e;return!!(null==(e=c.value[d.value])?void 0:e.userScore)}));let h=e.computed((()=>{var e;return v?null==(e=c.value[d.value])?void 0:e.userScore:0}));function g(){u.value=!u.value}function x(){e.index.navigateBack({fail(){e.index.switchTab({url:"/pages/index/index"})}})}function w(){f.value=k(),i.value.open()}function y(){i.value.close()}function _(){f.value=k(),s.value.open()}function b(){c.value[d.value].score=r.value,async function(){e.index.showLoading({title:"加载中..."});let t={classid:f.value.classid,wallId:f.value._id,userScore:r.value},o=await a.reqGetSetupScore(t);e.index.hideLoading(),0==o.errCode&&(c.value[d.value].userScore=r.value,e.index.setStorageSync("imageList",c.value),e.index.showModal({title:"评分提醒",content:"成功评分了，亲~~~",showCancel:!1}))}(),s.value.close()}function S(){s.value.close()}function I(e){d.value=e.detail.current,C(d.value),f.value=k(),r.value=0}function k(){let e=c.value[d.value],{...a}=e;return a}function L(){try{let a=e.index.getStorageSync("imageList");c.value=a.map((e=>(e.fullPicurl=e.smallPicurl.replace("_small.webp",".jpg"),e)))}catch(a){console.log(a)}}async function P(){try{e.index.showLoading({title:"下载中...",mask:!0}),f.value=k();let t={classid:f.value.classid,wallId:f.value._id},o=await a.reqDownloadPic(t);if(0!==o.data.errCode)return e.index.showToast({title:"下载失败",duration:2e3}),void e.index.hideLoading();0==o.data.errCode&&e.index.getImageInfo({src:f.value.fullPicurl,success(a){e.index.saveImageToPhotosAlbum({filePath:a.path,success(){e.index.showModal({title:"保存到相册成功",showCancel:!1})},fail(a){"saveImageToPhotosAlbum:fail cancel"!=a.errMsg?"saveImageToPhotosAlbum:fail auth deny"==a.errMsg&&e.index.showModal({title:"保存照片失败",content:"请确认授予保存照片的权限",success(a){a.confirm&&e.index.openSetting({success(a){a.authSetting["scope.writePhotosAlbum"]?e.index.showToast({title:"获取授权成功",icon:"success"}):e.index.showToast({title:"获取授权失败",icon:"error"})}})}}):e.index.showToast({title:"保存失败，请点击重新下载",icon:"none"})},complete(){e.index.hideLoading()}})},complete(){e.index.hideLoading()}})}catch(t){e.index.hideLoading()}}function C(e){p.value.push(e-1<0?m.value-1:e-1,e,e+1>m.value-1?0:e+1),p.value=[...new Set(p.value)]}return e.onLoad((t=>{if(u.value&&(u.value=!1),t.currentIndex&&(d.value=+t.currentIndex,L()),t.id){let o={id:t.id};d=0,async function(t){let o=await a.reqSingleImage(t);0==o.errCode&&e.index.setStorageSync("imageList",o.data)}(o).then((()=>{L(),f.value=k()}))}C(d.value)})),e.onShareAppMessage((()=>(f.value=k(),{title:"天天壁纸",desc:"天天壁纸，每天分享好看的壁纸~~~",path:"/pages/detail/detail?id="+f.value._id,success(){e.index.showToast({title:"分享成功！"})}}))),(a,t)=>({a:e.f(c.value,((a,t,o)=>e.e({a:e.unref(p).includes(t)},e.unref(p).includes(t)?{b:a.fullPicurl}:{},{c:a._id}))),b:e.unref(d),c:e.o(I),d:e.p({type:"back",color:"#fafafa",size:"30"}),e:e.s(`top:${e.unref(n)}px`),f:e.o(x),g:e.t(e.unref(d)+1),h:e.t(c.value.length),i:e.p({date:new Date,format:"hh:mm"}),j:e.p({date:new Date,format:"MM/dd"}),k:e.s(`top:${e.unref(l)}px`),l:e.p({type:"info",size:"30",color:"black"}),m:e.o(w),n:e.p({type:"star",size:"30",color:"black"}),o:e.o(_),p:e.p({type:"download",size:"30",color:"black"}),q:e.o(P),r:e.unref(u),s:e.o(y),t:e.p({type:"closeempty",size:"15"}),v:e.t(f.value._id),w:e.t(f.value.nickname),x:e.p({value:f.value.score,touchable:!0,"allow-half":!0,size:"15",readonly:!0}),y:e.t(f.value.score),z:e.t(f.value.description),A:e.f(f.value.tabs,((a,t,o)=>({a:e.t(a),b:t}))),B:e.sr(i,"6f6d8384-6",{k:"popupInfo"}),C:e.p({type:"bottom"}),D:e.t(e.unref(v)?"已经评分过了~~~":"请给个评分吧~~~"),E:e.o(S),F:e.p({type:"closeempty",size:"15"}),G:e.o((a=>e.isRef(r)?r.value=a:r=a)),H:e.p({"allow-half":!0,disabled:e.unref(v),modelValue:e.unref(r)}),I:e.t(e.unref(v)?e.unref(h):e.unref(r)),J:e.o(b),K:e.unref(v),L:e.sr(s,"6f6d8384-9",{k:"popupgarde"}),M:e.o(g)})}},n=e._export_sfc(o,[["__scopeId","data-v-6f6d8384"]]);o.__runtimeHooks=2,wx.createPage(n);
